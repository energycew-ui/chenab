<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Smart Energy Dashboard</title>

<script src="https://unpkg.com/feather-icons"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>

<style>
.card:hover{
  transform:scale(1.05);
  transition:.3s;
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
  }
body {
      font-size: 1.06rem;
      background-image: url('https://chenabengineering.com/wp-content/uploads/2023/06/istockphoto-1147790557-612x612-1.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
  
}
.animate-blink{animation:blink 1s infinite;}
@keyframes blink{0%{opacity:1}50%{opacity:.5}100%{opacity:1}}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, onValue, off, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyApTAM7ZAvxHBDjVNFe7ARN5iNtshA8TFQ",
  authDomain: "energy-monitoring-chenab-60e72.firebaseapp.com",
  databaseURL: "https://energy-monitoring-chenab-60e72-default-rtdb.firebaseio.com/",
  projectId: "energy-monitoring-chenab-60e72"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ===================== FIELDS ===================== */
/* ❗ MDI IS ADDED AT THE END ONLY */
const fields = [
  "VOLTAGE_AB","VOLTAGE_BC","VOLTAGE_CA",
  "AVERAGE_PHASE_VOLTAGE",
  "L1_Voltage","L2_Voltage","L3_Voltage",
  "AVERAGE_VOLTAGE",
  "current_phase_1","current_phase_2","current_phase_3",
  "Average_current",
  "POWER_PHASE_A","POWER_PHASE_B","POWER_PHASE_C",
  "TOTAL_POWER",
  "FREQUENCY",
  "PowerFactorTotal",
  "TotalKWh",

  /* ===== MDI (LAST ONLY) ===== */
  "Present_Demand",
  "Maximum_Demand_MDI",
  "Last_MDI_Reset_Time",
  "MDI_Reset_Schedule"
];

const icons = {
  AVERAGE_PHASE_VOLTAGE:"zap",
  AVERAGE_VOLTAGE:"zap",
  L1_Voltage:"zap",L2_Voltage:"zap",L3_Voltage:"zap",
  VOLTAGE_AB:"zap",VOLTAGE_BC:"zap",VOLTAGE_CA:"zap",
  current_phase_1:"activity",current_phase_2:"activity",current_phase_3:"activity",
  Average_current:"activity",
  POWER_PHASE_A:"battery-charging",POWER_PHASE_B:"battery-charging",POWER_PHASE_C:"battery-charging",
  TOTAL_POWER:"battery",
  FREQUENCY:"refresh-cw",
  PowerFactorTotal:"percent",
  TotalKWh:"database",

  /* MDI */
  Present_Demand:"activity",
  Maximum_Demand_MDI:"trending-up",
  Last_MDI_Reset_Time:"clock",
  MDI_Reset_Schedule:"calendar"
};

const fieldColors={
  VOLTAGE_AB:"bg-blue-100",VOLTAGE_BC:"bg-blue-100",VOLTAGE_CA:"bg-blue-100",
  AVERAGE_PHASE_VOLTAGE:"bg-blue-100",
  L1_Voltage:"bg-blue-100",L2_Voltage:"bg-blue-100",L3_Voltage:"bg-blue-100",
  AVERAGE_VOLTAGE:"bg-blue-100",
  current_phase_1:"bg-yellow-100",current_phase_2:"bg-yellow-100",current_phase_3:"bg-yellow-100",
  Average_current:"bg-yellow-100",
  POWER_PHASE_A:"bg-orange-100",POWER_PHASE_B:"bg-orange-100",POWER_PHASE_C:"bg-orange-100",
  TOTAL_POWER:"bg-orange-100",
  FREQUENCY:"bg-indigo-100",
  PowerFactorTotal:"bg-green-100",
  TotalKWh:"bg-red-100",

  /* MDI */
  Present_Demand:"bg-purple-100",
  Maximum_Demand_MDI:"bg-red-200",
  Last_MDI_Reset_Time:"bg-gray-200",
  MDI_Reset_Schedule:"bg-gray-100"
};

const cards=document.getElementById("cards");
const pathSelector=document.getElementById("pathSelector");
const clockEl=document.getElementById("clock");
let lastPath=null;

function updateCards(data){
  cards.innerHTML="";
  fields.forEach(f=>{
    if(data[f]===undefined) return;
    const d=document.createElement("div");
    d.className=`card p-4 rounded-xl shadow ${fieldColors[f]||"bg-white"} text-center`;
    d.innerHTML=`
      <div class="flex justify-center mb-1">
        <i data-feather="${icons[f]||"box"}"></i>
      </div>
      <h2 class="text-sm font-bold">${f}</h2>
      <p class="text-xl font-semibold">
        ${data[f]}
        ${["VOLTAGE_AB","VOLTAGE_BC","VOLTAGE_CA","AVERAGE_VOLTAGE","L1_Voltage","L2_Voltage","L3_Voltage"].includes(f)?" V":""}
        ${["current_phase_1","current_phase_2","current_phase_3","Average_current"].includes(f)?" A":""}
        ${["POWER_PHASE_A","POWER_PHASE_B","POWER_PHASE_C","TOTAL_POWER","Present_Demand","Maximum_Demand_MDI"].includes(f)?" kW":""}
        ${f==="TotalKWh"?" kWh":""}
        ${f==="FREQUENCY"?" Hz":""}
      </p>`;
    cards.appendChild(d);
  });
  feather.replace();
}

function loadData(p){
  if(lastPath) off(ref(db,lastPath));
  lastPath=p;
  onValue(ref(db,p),s=>{
    const d=s.val();
    if(!d) return;
    updateCards(d);
  });
}

async function loadPaths(){
  const s=await get(ref(db));
  const paths=Object.keys(s.val()||{});
  paths.forEach(p=>{
    const o=document.createElement("option");
    o.value=p;o.textContent=p;
    pathSelector.appendChild(o);
  });
  if(paths.length) loadData(paths[0]);
}

function updateClock(){
  clockEl.textContent=new Date().toLocaleString("en-PK",{timeZone:"Asia/Karachi",hour12:true});
}

setInterval(updateClock,1000);
updateClock();
pathSelector.addEventListener("change",()=>loadData(pathSelector.value));
loadPaths();
</script>
</head>

<body>

<!-- ✅ CHENAB LOGO HEADER (RESTORED) -->
<section class="bg-white py-2 hidden md:block">
  <div class="container mx-auto flex justify-between items-center">
    <img src="https://chenabengineering.com/wp-content/uploads/2023/06/chenab-logo-1-scaled.png" class="h-14">
    <div class="text-sm">
      <div><i class="fas fa-phone"></i> +923027930594</div>
      <div><i class="fas fa-envelope"></i> energy.cew@gmail.com</div>
    </div>
  </div>
</section>

<header class="bg-green-700 text-white p-4 flex justify-between items-center">
  <div>
    <label>Select Section:</label>
    <select id="pathSelector" class="text-black p-1 rounded"></select>
  </div>
  <div class="text-center">
    <h1 class="text-xl font-bold">Smart Energy Dashboard</h1>
    <div id="clock" class="text-sm"></div>
  </div>
</header>

<main class="p-4 container mx-auto">
  <section id="cards" class="grid grid-cols-2 md:grid-cols-4 gap-4"></section>
</main>

</body>
</html>
<!-- Logo and Contact Info Section --> <section class="elementor-section elementor-top-section elementor-element elementor-element-54fb42c2 elementor-hidden-mobile elementor-section-boxed elementor-section-height-default bg-white py-2" data-id="54fb42c2" data-element_type="section"> <div class="elementor-container elementor-column-gap-default flex justify-between items-center"> <div class="elementor-column elementor-col-50 elementor-inner-column elementor-element elementor-element-1282328d" data-id="1282328d" data-element_type="column"> <div class="elementor-widget-wrap elementor-element-populated"> <div class="elementor-element elementor-element-6813c628 elementor-widget elementor-widget-image" data-id="6813c628" data-element_type="widget" data-widget_type="image.default"> <div class="elementor-widget-container"> <a href="https://chenabengineering.com"> <img fetchpriority="high" width="2560" height="606" src="https://chenabengineering.com/wp-content/uploads/2023/06/chenab-logo-1-scaled.png" class="attachment-full size-full wp-image-19" alt="Chenab Engineering works Logo" srcset="https://chenabengineering.com/wp-content/uploads/2023/06/chenab-logo-1-scaled.png 2560w, https://chenabengineering.com/wp-content/uploads/2023/06/chenab-logo-1-1024x243.png 1024w, https://chenabengineering.com/wp-content/uploads/2023/06/chenab-logo-1-300x71.png 300w, https://chenabengineering.com/wp-content/uploads/2023/06/chenab-logo-1-768x182.png 768w, https://chenabengineering.com/wp-content/uploads/2023/06/chenab-logo-1-1536x364.png 1536w, https://chenabengineering.com/wp-content/uploads/2023/06/chenab-logo-1-2048x485.png 2048w, https://chenabengineering.com/wp-content/uploads/2023/06/chenab-logo-1-600x142.png 600w" sizes="(max-width: 2560px) 100vw, 2560px"> </a> </div> </div> </div> </div> <div class="elementor-column elementor-col-50 elementor-inner-column elementor-element elementor-element-125b9dea elementor-hidden-mobile justify-end" data-id="125b9dea" data-element_type="column"> <div class="elementor-widget-wrap elementor-element-populated"> <div class="elementor-element elementor-element-45fd0a91 elementor-icon-list--layout-inline elementor-align-right elementor-list-item-link-full_width elementor-widget elementor-widget-icon-list" data-id="45fd0a91" data-element_type="widget" data-widget_type="icon-list.default"> <div class="elementor-widget-container"> <ul class="elementor-icon-list-items elementor-inline-items"> <li class="elementor-icon-list-item elementor-inline-item"> <a href="tel:+92302793059,+923097772868"> <span class="elementor-icon-list-icon"><i aria-hidden="true" class="fas fa-phone"></i></span> <span class="elementor-icon-list-text">+923027930594,+923097772868</span> </a> </li> <li class="elementor-icon-list-item elementor-inline-item"> <a href="mailto:energy.cew@gmail.com"> <span class="elementor-icon-list-icon"><i aria-hidden="true" class="fas fa-envelope"></i></span> <span class="elementor-icon-list-text">energy.cew@gmail.com</span> </a> </li> </ul> </div> </div> <div class="elementor-element elementor-element-dfac8b8 elementor-icon-list--layout-inline elementor-align-right elementor-list-item-link-full_width elementor-widget elementor-widget-icon-list" data-id="dfac8b8" data-element_type="widget" data-widget_type="icon-list.default"> <div class="elementor-widget-container"> <ul class="elementor-icon-list-items elementor-inline-items"> <li class="elementor-icon-list-item elementor-inline-item"> <span class="elementor-icon-list-text"><b>For Queries & Marketing:</b></span> </li> <li class="elementor-icon-list-item elementor-inline-item"> <a href="mailto:energy.cew@gmail.com"> <span class="elementor-icon-list-icon"><i aria-hidden="true" class="fas fa-envelope"></i></span> <span class="elementor-icon-list-text">energy.cew@gmail.com</span> </a> </li> </ul> </div> </div> </div> </div> </div> </section> <!-- Header --> <header class="bg-green-700 text-white p-4 flex justify-between items-center"> <div class="flex items-center gap-4"> <label for="pathSelector" class="font-semibold">select section:</label> <select id="pathSelector" class="text-black p-1 rounded"></select> <!-- Metric selector --> <label for="metricSelector" class="font-semibold ml-3">metric:</label> <select id="metricSelector" class="text-black p-1 rounded"> <option value="__ALL__">All</option> </select> </div> <h1 class="text-xl font-bold text-center flex-1">Smart Energy Dashboard</h1> <div id="clock" class="text-sm font-semibold"></div> </header>




